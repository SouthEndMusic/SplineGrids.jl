<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Local refinement (THB-splines) · SplineGrids.jl</title><meta name="title" content="Local refinement (THB-splines) · SplineGrids.jl"/><meta property="og:title" content="Local refinement (THB-splines) · SplineGrids.jl"/><meta property="twitter:title" content="Local refinement (THB-splines) · SplineGrids.jl"/><meta name="description" content="Documentation for SplineGrids.jl."/><meta property="og:description" content="Documentation for SplineGrids.jl."/><meta property="twitter:description" content="Documentation for SplineGrids.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SplineGrids.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">SplineGrids.jl</a></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../theory_refinement/">Refinement</a></li><li class="is-active"><a class="tocitem" href>Local refinement (THB-splines)</a><ul class="internal"><li><a class="tocitem" href="#An-example"><span>An example</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples_dimensions/">Dimensionality</a></li><li><a class="tocitem" href="../examples_nurbs/">NURBS</a></li><li><a class="tocitem" href="../examples_derivatives/">Derivatives</a></li><li><a class="tocitem" href="../examples_linear_fitting/">Linear fitting</a></li><li><a class="tocitem" href="../examples_enzyme/">Control point derivatives with Enzyme</a></li></ul></li><li><span class="tocitem">Advanced examples</span><ul><li><a class="tocitem" href="../examples_pde/">Solving a PDE</a></li><li><a class="tocitem" href="../examples_optics/">Optimizing a lens surface</a></li></ul></li><li><a class="tocitem" href="../manual/">Manual</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory</a></li><li class="is-active"><a href>Local refinement (THB-splines)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Local refinement (THB-splines)</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SouthEndMusic/SplineGrids.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SouthEndMusic/SplineGrids.jl/blob/master/docs/src/theory_local_refinement.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Local-refinement"><a class="docs-heading-anchor" href="#Local-refinement">Local refinement</a><a id="Local-refinement-1"></a><a class="docs-heading-anchor-permalink" href="#Local-refinement" title="Permalink"></a></h1><p>As we have seen in the previous section (<a href="../theory_refinement/#Refinement">Refinement</a>), The number of control points can be increased without changing the geometry by using refinement matrices. The key concepts of local refinement are as follows:</p><ol><li>Set up a base grid of control points</li><li>Extend the control point grid using refinement matrices</li><li>Overwrite certain control points in one of the intermediate extended grids</li></ol><div class="admonition is-info"><header class="admonition-header">Understanding THB splines</header><div class="admonition-body"><p>THB-splines can be a tricky construct to understand when you encounter them for the first time. This page does not aim to give a full theoretical background, that can be for instance found in <a href="https://www.ag.jku.at/pubs/2016gjkmss.pdf">[1]</a>. Playing around with THB-splines in the context of this package might however give you intuition for them more quickly than reading the theory.</p></div></div><h2 id="An-example"><a class="docs-heading-anchor" href="#An-example">An example</a><a id="An-example-1"></a><a class="docs-heading-anchor-permalink" href="#An-example" title="Permalink"></a></h2><p>Local refinement is probably best understood using an example. We use a surface here, because local refinement of curves is trivial.</p><p>We create a surface, and have a look at its basis functions.</p><pre><code class="language-julia hljs">using SplineGrids
using CairoMakie

n_control_points = (6, 6)
degree = (2, 2)
n_sample_points = (500, 500)
dim_out = 3

spline_dimensions = SplineDimension.(n_control_points, degree, n_sample_points)
spline_grid = SplineGrid(spline_dimensions, dim_out)
plot_basis(spline_grid)</code></pre><img src="bba80746.png" alt="Example block output"/><p>This basis looks rather &#39;Cartesian&#39;, and knot insertion can only refine the basis in whole rows and columns. So what we do is set up refinement matrices for both dimensions, use some of the old basis functions and use some of the new ones.</p><pre><code class="language-julia hljs"># Set up `LocallyRefinedControlPoints` with a refinement matrix for both dimensions
spline_grid = add_default_local_refinement(spline_grid)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SplineGrid surface with outputs in ℝ³ (Float32)
-----------------------------------------------
* Properties per dimension:
┌─────────────────┬────────┬───────────────────┬─────────────────┐
│<span class="sgr1"> input dimension │ degree │ # basis functions │ # sample points │
├─────────────────┼────────┼───────────────────┼─────────────────┤
│               1 │      2 │                10 │             500 │
│               2 │      2 │                10 │             500 │
└─────────────────┴────────┴───────────────────┴─────────────────┘
* Control points:
LocallyRefinedControlPoints for final grid of size (10, 10) in ℝ³ (Float32). Local refinements:
┌────────────┬───────────────┬──────────────┬──────────────────┐
│ input dim. │ # c.p. before │ # c.p. after │ # activated c.p. │
├────────────┼───────────────┼──────────────┼──────────────────┤
│          1 │             6 │           10 │                0 │
│          2 │             6 │           10 │                0 │
└────────────┴───────────────┴──────────────┴──────────────────┘
</span></code></pre><pre><code class="language-julia hljs"># Activate control point ranges (by default in the last extended control point grid).
# Note that some of these ranges overlap, this is fine and no duplicate control points are created
activate_local_control_point_range!(spline_grid, 1:4, 1:6)
activate_local_control_point_range!(spline_grid, 1:6, 1:2)
activate_local_control_point_range!(spline_grid, 9:10, 7:10)
plot_basis(spline_grid)</code></pre><img src="c8794cf6.png" alt="Example block output"/><p>A nice property of this construction is that it can be iterated, creating a hierarchy. Let&#39;s refine the basis some more:</p><pre><code class="language-julia hljs">spline_grid = add_default_local_refinement(spline_grid)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SplineGrid surface with outputs in ℝ³ (Float32)
-----------------------------------------------
* Properties per dimension:
┌─────────────────┬────────┬───────────────────┬─────────────────┐
│<span class="sgr1"> input dimension │ degree │ # basis functions │ # sample points │
├─────────────────┼────────┼───────────────────┼─────────────────┤
│               1 │      2 │                18 │             500 │
│               2 │      2 │                18 │             500 │
└─────────────────┴────────┴───────────────────┴─────────────────┘
* Control points:
LocallyRefinedControlPoints for final grid of size (18, 18) in ℝ³ (Float32). Local refinements:
┌────────────┬───────────────┬──────────────┬──────────────────┐
│ input dim. │ # c.p. before │ # c.p. after │ # activated c.p. │
├────────────┼───────────────┼──────────────┼──────────────────┤
│          1 │             6 │           10 │                0 │
│          2 │             6 │           10 │               36 │
│          1 │            10 │           18 │                0 │
│          2 │            10 │           18 │                0 │
└────────────┴───────────────┴──────────────┴──────────────────┘
</span></code></pre><pre><code class="language-julia hljs">activate_local_control_point_range!(spline_grid, 5:12, 1:4)
activate_local_control_point_range!(spline_grid, 7:8, 5:6)
plot_basis(spline_grid)</code></pre><img src="0580f121.png" alt="Example block output"/><p>This is in fact an exact reproduction of the THB-spline example shown in <a href="https://www.ag.jku.at/pubs/2016gjkmss.pdf">[1]</a> (p. 6).</p><p>Finally, let&#39;s give the <span>$z$</span>-coordinates of the control points some random values and look at the surface.</p><pre><code class="language-julia hljs">using Plots
using Random
Random.seed!(42)

spline_grid.control_points[:, 3] .= rand(Float32, get_n_control_points(spline_grid))
evaluate!(spline_grid.control_points)
evaluate!(spline_grid)
p = Plots.plot(spline_grid, camera = (30, 60, 1.5))
Plots.zlims!(p, 0, 1)</code></pre><img src="9c445ba3.svg" alt="Example block output"/><p>See <a href="../examples_linear_fitting/#Local-refinement-informed-by-local-error">Local refinement informed by local error</a> for an example of how a local fitting error can be used to inform where to refine.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p>[1] Giannelli, C., Jüttler, B., Kleiss, S. K., Mantzaflaris, A., Simeon, B., &amp; Špeh, J. (2016). <em>THB-splines: An effective mathematical technology for adaptive refinement in geometric design and isogeometric analysis.</em> Computer Methods in Applied Mechanics and Engineering, 299, 337-365.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../theory_refinement/">« Refinement</a><a class="docs-footer-nextpage" href="../examples_dimensions/">Dimensionality »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Friday 24 January 2025 08:27">Friday 24 January 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
